<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Track & Trace System</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f9f9f9;
    }
    h2 {
        text-align: center;
    }
    .form-wrapper {
        background: none;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
        max-width: 2000px;
        margin: 0 auto 20px;
    }
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px 40px;
    }
    label {
        font-weight: bold;
        margin-top: 8px;
        display: block;
    }
    input, select {
        width: 100%;
        padding: 6px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .button-bar {
        text-align: center;
        margin-top: 15px;
    }
    .btn {
        padding: 8px 14px;
        border: none;
        border-radius: 2px;
        cursor: pointer;
        color: white;
        margin: 5px;
    }
    .save-btn { background-color: green; }
    .delete-btn { background-color: red; }
    .export-btn { background-color: #007bff; }
    .import-btn { background-color: #ff9800; }
    .save-btn:hover { background-color: darkgreen; }
    .delete-btn:hover { background-color: darkred; }
    .export-btn:hover { background-color: #0056b3; }
    .import-btn:hover { background-color: #e68900; }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        margin-top: 10px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
    }
    tr:hover { background-color: #f1f1f1; cursor: pointer; }
    .selected-row { background-color: #d9edf7 !important; }
</style>
</head>
<body>

<h2>📦 Track & Trace System</h2>

<!-- FORM -->
<div class="form-wrapper">
    <div class="form-grid">
        <div>
            <label>Requested By</label><input type="text" id="requestedBy">
            <label>Requested Date</label><input type="date" id="requestedDate">
            <label>Pickup Date</label><input type="date" id="pickupDate">
            <label>Unit</label><input type="text" id="unit">
            <label>Serial Number</label><input type="text" id="serialNumber">
            <label>Origin</label><input type="text" id="origin">
            <label>Destination</label><input type="text" id="destination">
        </div>

        <div>
            <label>Shipping Lines</label><input type="text" id="shippingLines">
            <label>ETD</label><input type="date" id="etd">
            <label>ATD</label><input type="date" id="atd">
            <label>ETA</label><input type="date" id="eta">
            <label>ATA</label><input type="date" id="ata">
            <label>Actual Delivered</label><input type="date" id="actualDelivered">
            <label>Status</label>
            <select id="status">
                <option value="">Select...</option>
                <option value="Pending">Pending</option>
                <option value="Delivered">Delivered</option>
                <option value="Delayed">Delayed</option>
            </select>
            <label>Remarks</label><input type="text" id="remarks">
        </div>
    </div>

    <div class="button-bar">
        <input type="button" class="btn save-btn" id="saveBtn" value="Save / Update" onclick="saveRecord()">
        <input type="button" class="btn delete-btn" id="deleteBtn" value="Delete" onclick="deleteRecord()">
        <input type="button" class="btn export-btn" value="Export Data" onclick="exportData()">
        <input type="button" class="btn import-btn" value="Import Data" onclick="importData()">
    </div>
</div>

<!-- RECORDS TABLE -->
<div class="form-wrapper">
    <h3 style="text-align:center;">📋 Records</h3>
    <table id="recordsTable">
        <tr>
            <th>Requested By</th>
            <th>Requested Date</th>
            <th>Pickup Date</th>
            <th>Unit</th>
            <th>Serial Number</th>
            <th>Origin</th>
            <th>Destination</th>
            <th>Shipping Lines</th>
            <th>ETD</th>
            <th>ATD</th>
            <th>ETA</th>
            <th>ATA</th>
            <th>Actual Delivered</th>
            <th>Status</th>
            <th>Remarks</th>
        </tr>
    </table>
</div>

<script>
let selectedId = null;

// Load records on startup
window.onload = refreshTable;

function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
}

function getFormData() {
    return {
        id: selectedId || generateId(),
        requestedBy: document.getElementById('requestedBy').value,
        requestedDate: document.getElementById('requestedDate').value,
        pickupDate: document.getElementById('pickupDate').value,
        unit: document.getElementById('unit').value,
        serialNumber: document.getElementById('serialNumber').value,
        origin: document.getElementById('origin').value,
        destination: document.getElementById('destination').value,
        shippingLines: document.getElementById('shippingLines').value,
        etd: document.getElementById('etd').value,
        atd: document.getElementById('atd').value,
        eta: document.getElementById('eta').value,
        ata: document.getElementById('ata').value,
        actualDelivered: document.getElementById('actualDelivered').value,
        status: document.getElementById('status').value,
        remarks: document.getElementById('remarks').value
    };
}

// ✅ Save or update record
function saveRecord() {
    let records = JSON.parse(localStorage.getItem('trackRecords')) || [];
    const formData = getFormData();

    if (!formData.requestedBy || !formData.unit) {
        alert("Please fill 'Requested By' and 'Unit'.");
        return;
    }

    const index = records.findIndex(r => r.id === selectedId);
    if (index >= 0) {
        records[index] = formData;
        showTempMessage("✅ Updated!", "saveBtn", "Save / Update");
    } else {
        records.push(formData);
        showTempMessage("✅ Saved!", "saveBtn", "Save / Update");
    }

    localStorage.setItem('trackRecords', JSON.stringify(records));
    refreshTable();
    clearForm();
    selectedId = null;
}

// ✅ Delete record
function deleteRecord() {
    if (!selectedId) {
        alert("Select a record first.");
        return;
    }

    if (confirm("Are you sure you want to delete this record?")) {
        let records = JSON.parse(localStorage.getItem('trackRecords')) || [];
        records = records.filter(r => r.id !== selectedId);
        localStorage.setItem('trackRecords', JSON.stringify(records));
        refreshTable();
        clearForm();
        showTempMessage("🗑️ Deleted!", "deleteBtn", "Delete");
        selectedId = null;
    }
}

// ✅ Export data
function exportData() {
    const data = localStorage.getItem('trackRecords') || '[]';
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'trackRecords.json';
    a.click();
    URL.revokeObjectURL(url);
}

// ✅ Import data
function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
            try {
                const newData = JSON.parse(reader.result);
                if (Array.isArray(newData)) {
                    localStorage.setItem('trackRecords', JSON.stringify(newData));
                    refreshTable();
                    alert("✅ Data imported successfully!");
                } else {
                    alert("Invalid file format.");
                }
            } catch (err) {
                alert("Error reading file.");
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// ✅ Temporary button feedback
function showTempMessage(msg, btnId, originalText) {
    const btn = document.getElementById(btnId);
    btn.value = msg;
    btn.disabled = true;
    setTimeout(() => {
        btn.value = originalText;
        btn.disabled = false;
    }, 1200);
}

// Refresh table
function refreshTable() {
    const table = document.getElementById("recordsTable");
    table.innerHTML = `
    <tr>
        <th>Requested By</th>
        <th>Requested Date</th>
        <th>Pickup Date</th>
        <th>Unit</th>
        <th>Serial Number</th>
        <th>Origin</th>
        <th>Destination</th>
        <th>Shipping Lines</th>
        <th>ETD</th>
        <th>ATD</th>
        <th>ETA</th>
        <th>ATA</th>
        <th>Actual Delivered</th>
        <th>Status</th>
        <th>Remarks</th>
    </tr>`;
    const records = JSON.parse(localStorage.getItem('trackRecords')) || [];
    records.forEach(addRowToTable);
}

function addRowToTable(record) {
    const table = document.getElementById("recordsTable");
    const row = table.insertRow(-1);
    row.setAttribute('data-id', record.id);
    const keys = ['requestedBy','requestedDate','pickupDate','unit','serialNumber','origin','destination','shippingLines','etd','atd','eta','ata','actualDelivered','status','remarks'];
    keys.forEach(key => {
        const cell = row.insertCell(-1);
        cell.innerText = record[key] || '';
    });
    row.onclick = function() {
        const rows = table.querySelectorAll("tr");
        rows.forEach(r => r.classList.remove("selected-row"));
        row.classList.add("selected-row");
        selectedId = record.id;
        for (let key in record) {
            if (document.getElementById(key)) {
                document.getElementById(key).value = record[key];
            }
        }
    };
}

function clearForm() {
    document.querySelectorAll('input, select').forEach(el => el.value = '');
}
</script>
</body>
</html>
